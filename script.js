const translations = {
    id: {
        pageTitle: "Bali Rentals",
        timeBaliText: "Bali",
        navHome: "Beranda",
        navVehicles: "Daftar Kendaraan",
        navContact: "Tentang Kami",
        stickyButton: "Hubungi Sekarang",
        stickyButtonHref: "https://wa.me/6281999919042?text=Halo%2C%20saya%20ingin%20bertanya%20tentang%20penyewaan%20kendaraan%20Anda.",
        heroHeading: "Bali Rentals",
        heroParagraph: "Temukan kendaraan impian Anda untuk liburan di Bali.",
        vehiclesSectionHeading: "Daftar Kendaraan",
        motorbikesHeading: "Motor",
        nmaxDescription: "Tampil lebih keren dengan Yamaha NMAX",
        nmaxBookBtn: "Pesan Sekarang",
        nmaxBookBtnHref: "https://wa.me/6281999919042?text=Halo%2C%20saya%20ingin%20memesan%20Yamaha%20NMAX.",
        scoopyDescription: "Tampil lebih keren dengan Honda Scoopy",
        scoopyBookBtn: "Pesan Sekarang",
        scoopyBookBtnHref: "https://wa.me/6281999919042?text=Halo%2C%20saya%20ingin%20memesan%20Honda%20Scoopy.",
        filanoDescription: "Tampil lebih keren dengan Yamaha Filano",
        filanoBookBtn: "Pesan Sekarang",
        filanoBookBtnHref: "https://wa.me/6281999919042?text=Halo%2C%20saya%20ingin%20memesan%20Yamaha%20Filano.",
        varioDescription: "Tampil lebih keren dengan Honda Vario",
        varioBookBtn: "Pesan Sekarang",
        varioBookBtnHref: "https://wa.me/6281999919042?text=Halo%2C%20saya%20ingin%20memesan%20Honda%20Vario.",
        carsHeading: "Mobil",
        agyaManualDescription: "Tampil lebih keren dengan Agya Manual",
        agyaManualBookBtn: "Pesan Sekarang",
        agyaManualBookBtnHref: "https://wa.me/6281999919042?text=Halo%2C%20saya%20ingin%20memesan%20Agya%20Manual.",
        agyaMaticDescription: "Tampil lebih keren dengan Agya Matic",
        agyaMaticBookBtn: "Pesan Sekarang",
        agyaMaticBookBtnHref: "https://wa.me/6281999919042?text=Halo%2C%20saya%20ingin%20memesan%20Agya%20Matic.",
        avanzaManualDescription: "Tampil lebih keren dengan Avanza",
        avanzaManualBookBtn: "Pesan Sekarang",
        avanzaManualBookBtnHref: "https://wa.me/6281999919042?text=Halo%2C%20saya%20ingin%20memesan%20Avanza%20Manual.",
        aboutHeading: "Tentang Bali Rentals",
        contactWhatsApp: "Kontak kami : +62 819-9991-9042",
        contactEmail: "email kami : sutanta_85@yahoo.co.id",
        aboutText: "Selamat datang di Bali Rentals, solusi transportasi terpercaya di Bali. Kami menyediakan motor dan mobil berkualitas dengan layanan cepat, mudah, dan dapat diandalkan. Kendaraan kami selalu terawat, menawarkan kenyamanan dan fleksibilitas dengan harga kompetitif. Pemesanan dapat dilakukan langsung melalui WhatsApp untuk respon cepat dan efisien. Nikmati perjalanan Anda di Bali dengan kendaraan terbaik dari Bali Rentals!",
        bugReportText: "Jika ada Bug atau masalah, silahkan hubungi kami melalui WhatsApp",
        creatorCredit: "&copy; Dibuat oleh Rafa",
        creditLine: "Kredit: Dibuat oleh Rafa | Gambar di atas di dapat berbagai sumber di internet"
    },
    en: {
        pageTitle: "Bali Rentals",
        timeBaliText: "Bali",
        navHome: "Home",
        navVehicles: "Vehicle List",
        navContact: "About Us",
        stickyButton: "Contact Now",
        stickyButtonHref: "https://wa.me/6281999919042?text=Hello%2C%20I%20would%20like%20to%20inquire%20about%20your%20rentals.",
        heroHeading: "Bali Rentals",
        heroParagraph: "Find your dream vehicle for your Bali vacation.",
        vehiclesSectionHeading: "Vehicle List",
        motorbikesHeading: "Motorbikes",
        nmaxDescription: "Look cooler with Yamaha NMAX",
        nmaxBookBtn: "Book Now",
        nmaxBookBtnHref: "https://wa.me/6281999919042?text=Hello%2C%20I%20want%20to%20book%20Yamaha%20NMAX.",
        scoopyDescription: "Look cooler with Honda Scoopy",
        scoopyBookBtn: "Book Now",
        scoopyBookBtnHref: "https://wa.me/6281999919042?text=Hello%2C%20I%20want%20to%20book%20Honda%20Scoopy.",
        filanoDescription: "Look cooler with Yamaha Filano",
        filanoBookBtn: "Book Now",
        filanoBookBtnHref: "https://wa.me/6281999919042?text=Hello%2C%20I%20want%20to%20book%20Yamaha%20Filano.",
        varioDescription: "Look cooler with Honda Vario",
        varioBookBtn: "Book Now",
        varioBookBtnHref: "https://wa.me/6281999919042?text=Hello%2C%20I%20want%20to%20book%20Honda%20Vario.",
        carsHeading: "Cars",
        agyaManualDescription: "Look cooler with Agya Manual",
        agyaManualBookBtn: "Book Now",
        agyaManualBookBtnHref: "https://wa.me/6281999919042?text=Hello%2C%20I%20want%20to%20book%20Agya%20Manual.",
        agyaMaticDescription: "Look cooler with Agya Matic",
        agyaMaticBookBtn: "Book Now",
        agyaMaticBookBtnHref: "https://wa.me/6281999919042?text=Hello%2C%20I%20want%20to%20book%20Agya%20Matic.",
        avanzaManualDescription: "Look cooler with Avanza",
        avanzaManualBookBtn: "Book Now",
        avanzaManualBookBtnHref: "https://wa.me/6281999919042?text=Hello%2C%20I%20want%20to%20book%20Avanza%20Manual.",
        aboutHeading: "About Bali Rentals",
        contactWhatsApp: "Contact us : +62 819-9991-9042",
        contactEmail: "email us : sutanta_85@yahoo.co.id",
        aboutText: "Welcome to Bali Rentals, your trusted transportation solution in Bali. We provide quality motorbikes and cars with fast, easy, and reliable service. Our vehicles are always well-maintained, offering comfort and flexibility at competitive prices. Bookings can be made directly via WhatsApp for quick and efficient response. Enjoy your trip in Bali with the best vehicles from Bali Rentals!",
        bugReportText: "If there are any bugs or issues, please contact us via WhatsApp",
        creatorCredit: "&copy; Created by Rafa",
        creditLine: "Credit: Created by Rafa | Images above are sourced from various internet sources"
    }
};

const rpPrices = {
    nmax: 170000,
    scoopy: 100000,
    filano: 120000,
    vario: 100000,
    agyaManualDaily: 250000,
    agyaManualMonthly: 6000000,
    agyaMaticDaily: 300000,
    agyaMaticMonthly: 6700000,
    avanzaManualDaily: 400000,
    avanzaManualMonthly: 9000000
};

let usdExchangeRate = 1;

async function fetchExchangeRate() {
    const API_KEY = 'YOUR_API_KEY';
    const API_URL = `https://api.exchangerate-api.com/v4/latest/IDR`;

    try {
        const response = await fetch(API_URL);
        const data = await response.json();
        if (data && data.rates && data.rates.USD) {
            usdExchangeRate = data.rates.USD;
        } else {
            console.error('Failed to fetch USD exchange rate from API.');
        }
    } catch (error) {
        console.error('Error fetching exchange rate:', error);
    }
}

function formatCurrency(amount, currency, lang) {
    if (currency === 'USD') {
        return new Intl.NumberFormat(lang === 'en' ? 'en-US' : 'id-ID', {
            style: 'currency',
            currency: 'USD'
        }).format(amount);
    } else {
        return new Intl.NumberFormat('id-ID', {
            style: 'currency',
            currency: 'IDR'
        }).format(amount);
    }
}

async function applyTranslations(lang) {
    document.documentElement.lang = lang;

    if (lang === 'en' && usdExchangeRate === 1) {
        await fetchExchangeRate();
    }

    for (const key in translations[lang]) {
        const element = document.getElementById(key);

        if (element && !key.endsWith('Href')) {
            if (key.includes('Price')) {
                let priceInRupiah;
                let isMonthly = false;

                if (key === 'nmaxPrice') priceInRupiah = rpPrices.nmax;
                else if (key === 'scoopyPrice') priceInRupiah = rpPrices.scoopy;
                else if (key === 'filanoPrice') priceInRupiah = rpPrices.filano;
                else if (key === 'varioPrice') priceInRupiah = rpPrices.vario;
                else if (key === 'agyaManualPrice') priceInRupiah = rpPrices.agyaManualDaily;
                else if (key === 'agyaManualMonthlyPrice') { priceInRupiah = rpPrices.agyaManualMonthly; isMonthly = true; }
                else if (key === 'agyaMaticPrice') priceInRupiah = rpPrices.agyaMaticDaily;
                else if (key === 'agyaMaticMonthlyPrice') { priceInRupiah = rpPrices.agyaMaticMonthly; isMonthly = true; }
                else if (key === 'avanzaManualPrice') priceInRupiah = rpPrices.avanzaManualDaily;
                else if (key === 'avanzaManualMonthlyPrice') { priceInRupiah = rpPrices.avanzaManualMonthly; isMonthly = true; }

                if (priceInRupiah !== undefined) {
                    if (lang === 'id') {
                        element.textContent = formatCurrency(priceInRupiah, 'IDR', lang) + (isMonthly ? ' / Bulan' : ' / Hari');
                    } else {
                        const priceInUsd = priceInRupiah * usdExchangeRate;
                        element.textContent = formatCurrency(priceInUsd, 'USD', lang) + (isMonthly ? ' / Month' : ' / Day');
                    }
                }
            } else if (key === 'creditLine') {
                document.querySelector('.credit').dataset.credit = translations[lang][key];
                document.querySelector('.credit').textContent = translations[lang][key];
            } else if (key === 'creatorCredit') {
                element.innerHTML = translations[lang][key];
            } else {
                element.textContent = translations[lang][key];
            }
        }

        if (key.endsWith('Href')) {
            const originalId = key.replace('Href', '');
            const linkElement = document.getElementById(originalId);
            if (linkElement && translations[lang][key]) {
                linkElement.href = translations[lang][key];
            }
        }
    }

    document.querySelectorAll('.lang-button').forEach(button => {
        if (button.dataset.lang === lang) {
            button.classList.add('active');
        } else {
            button.classList.remove('active');
        }
    });

    const newUrl = new URL(window.location);
    newUrl.searchParams.set('lang', lang);
    history.pushState({ lang: lang }, '', newUrl.toString());
}

document.querySelectorAll('.lang-button').forEach(button => {
    button.addEventListener('click', () => {
        applyTranslations(button.dataset.lang);
    });
});

const urlParams = new URLSearchParams(window.location.search);
const initialLang = urlParams.get('lang') || 'id';

fetchExchangeRate().then(() => {
    applyTranslations(initialLang);
});

window.addEventListener('popstate', (event) => {
    if (event.state && event.state.lang) {
        applyTranslations(event.state.lang);
    } else {
        const currentUrlParams = new URLSearchParams(window.location.search);
        const langFromUrl = currentUrlParams.get('lang') || 'id';
        applyTranslations(langFromUrl);
    }
});
